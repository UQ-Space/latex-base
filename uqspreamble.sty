\NeedsTeXFormat{LaTeX2e}
\RequirePackage{expl3}                                 % - Load LaTeX3 packages


%% ============================================================================
%%                           ~~~ CLASS META-INFO ~~~
%% ____________________________________________________________________________

\ProvidesExplPackage
  {uqspreamble}                                                 % - Name
  {2020/10/24}                                                  % - Date
  {1.1.0}                                                       % - Version
  {Report preamble list for use by UQ Space}                    % - Description

%% ============================================================================



%% ============================= General packages =============================


\usepackage { parskip    }    % Improves paragraph spacing
\usepackage { geometry   }
\usepackage { afterpage  }
\usepackage { ragged2e   }

\usepackage { microtype  }    % Tweak font spacing for aesthetics

\usepackage { multicol   }    % Multiple columns Environment
\usepackage { acro       }    % Acronyms and list-of-acronyms
\usepackage { genmpage   }    % Minipage options
\usepackage [ strict ]{ changepage }

\usepackage { pdfpages   }    % Allows inclusion of non-tex pdfs


%% ----------------------------- General commands -----------------------------

% -- Create possessive endings for acronyms

\DeclareAcroEnding { possessive } { 's } { 's }
\NewAcroCommand \acg { m }{
  \acropossessive \UseAcroTemplate { first }{ #1 }
}

\linespread{1.15}                      % Nicer linespreading
\setcounter{tocdepth}{3}               % Count 3 levels within TOC

\NewDocumentCommand \frontmatter { }{
  \pagenumbering{roman}
  \pagestyle{simple}
}

\NewDocumentCommand \mainmatter { }{
  \pagenumbering{arabic}
  \pagestyle{fancy}
}

%% ============================================================================



%% ========================= Maths & Science packages =========================

\usepackage{
  amsmath, amssymb,
  amsthm,  amsfonts
}
\usepackage[                           % Consistent formatting of SI Units
  per-mode=symbol,                     % ~ e.g. \SI{8314}{\kJ\per\kg\per\K},
  separate-uncertainty=true,           % ~      \num{1e6}, \ang{45}, etc...
  multi-part-units=single
]                     { siunitx }
\usepackage           { mathtools   }  % Space tweaking within maths
\usepackage           { chemformula }  % Chemical equations -> e.g. \ch{H20}
\usepackage           { bm          }  % Bold maths symbols -> e.g. \bm{\alpha}
\usepackage           { xfrac       }  % Use \sfrac{}{} for slanted fractions
\usepackage           { esint       }  % Gives nicer integration symbols
\usepackage           { cancel      }  % Gives \cancelto{val}{var}
\usepackage [ super ] { nth         }  % Ordinal indicators, with superscript
                                       % ~ e.g \nth{1} gives 1^st
\usepackage { circledsteps }
\usepackage { skmath       }  % Extensive simple math commands

%% ------------------------- Maths & Science commands -------------------------

\numberwithin { equation }{ section }

\let\vec\bm  % Use bold notation for vectors

\DeclareSIUnit \ft { ft }                % \inch and \ft for imperial units
\DeclareSIUnit [ number-unit-product = \thinspace ] \inch { in }
\DeclareSIUnit \aud { \textsc{Aud}\thinspace\$ }
\DeclareSIUnit \usd { \textsc{USD}\thinspace\$ }

%% ============================================================================



%% ============================= Figure packages ==============================

\usepackage { graphicx    }
\usepackage { tikz        }
\usepackage { tikz-3dplot }
\usepackage { svg         }

\usepackage { float      }
\usepackage [ export ]{ adjustbox  }
\usepackage { caption    }
\usepackage { subcaption }

%% ----------------------------- Figure commands ------------------------------

\graphicspath   { { images/ } }
\ExplSyntaxOff  % --> Tikz relies on spaces too much
\usetikzlibrary{arrows.meta,scopes,positioning,fadings}
\ExplSyntaxOn   % <--
\captionsetup   {
  format         = hang,
  figurewithin   = section,
  tablewithin    = section,
  figureposition = below,
  tableposition  = above,
  justification  = raggedright,
  skip           = 5pt,
  font           = small,
  textfont       = { sl, color=UQS Grey },
  labelfont      = { bf, color=UQS Blue }
}

\setlength \textfloatsep { 5pt }

\tikzset{debug~grid/.style = {
  step = 1.0,
  draw = gray!50,
  very~thin,
  overlay
}}

%% ============================================================================



%% ============================== Table packages ==============================

\usepackage { array    }               % For customisation of tables
\usepackage { booktabs }               % Horizontal rules in tables
\usepackage { multirow }
\usepackage { makecell }               % Robust table cells -> e.g. \makecell
                                       % ~ Allows for line-breaks within cells
                                       % ~ Use \thead{...} for column names

\usepackage { rotating       }         % Rotate cells with \begin{sideways}...
\usepackage { longtable      }         % Tables that go over multiple pages
\usepackage { threeparttable }         % Tables that allow for notes below
\usepackage { tablefootnote  }         % Allows for footnotes within tables

%% ------------------------------ Table commands ------------------------------

\arrayrulecolor { UQSBlue }

\renewcommand \theadfont { \bfseries \color{ UQS Blue } }
\renewcommand \arraystretch { 1.2 }    % Spread rows out by 20%

\let \oldthead \thead                  % Cache original `thead` command
\RenewDocumentCommand \thead { sm }{   % Additional starred functionality
  \IfBooleanTF { #1 }                  % ~ allows for usage within `enum`
  { \item[] } { }                      % ~ type columns
  \oldthead { #2 }
}

\newcolumntype { C }[ 1 ]{ >{ \Centering\arraybackslash   } p { #1 } }
\newcolumntype { R }[ 1 ]{ >{ \RaggedLeft\arraybackslash  } p { #1 } }
\newcolumntype { L }[ 1 ]{ >{ \RaggedRight\arraybackslash } p { #1 } }

\newcolumntype { M }[ 1 ]{ >{ \RaggedRight\arraybackslash } m { #1 } }
\newcolumntype { B }[ 1 ]{ >{ \RaggedRight\arraybackslash } b { #1 } }

\newcolumntype { E }[ 1 ]{ >{ \begin{tblEnum} } L { #1 } <{ \end{tblEnum} } }
\newcolumntype { I }[ 1 ]{ >{ \begin{tblItem} } L { #1 } <{ \end{tblItem} } }

\newcommand \tabitem {                 % Last resort for manually formatting
  \textbullet\quad                     % ~ dot points within tables
}

%% ============================================================================



%% ============================== List packages ===============================

\usepackage [ inline ]{ enumitem }               % For customisation of lists

%% ------------------------------ List commands -------------------------------

\makeatletter                          % For putting lists in tables properly
\newcommand*{\compress}{\@minipagetrue}
\makeatother

% --- Remove line spacing between items
\setlist { noitemsep }

% --- Remove all vertical spacing in itemize, change default label
\setitemize { nosep, label = $\triangleright$ }

% --- Create enumerate for within tables
\newlist { tblEnum }{ enumerate }{ 2 }
\setlist [ tblEnum ]{
  nosep,
  leftmargin = 3.5ex,
  label      =\arabic*.,
  labelwidth = 2.5ex,
  before     =\compress,
  after      =\vspace{-3ex}
}

% --- Create itemize for within tables
\newlist { tblItem }{ itemize }{ 2 }
\setlist [ tblItem ]{
  nosep,
  leftmargin = 3.5ex,
  labelwidth = 2.5ex,
  label      = $\triangleright$,
  before     =\compress,
  after      =\vspace{-3ex}
}

% --- Create description for List of Acronyms
\NewDocumentCommand \addcolon { m }{ #1: }
\newlist { acronyms }{ description }{ 2 }
\setlist [ acronyms ]{
  noitemsep,
  font       =\addcolon,
  labelwidth = 5em,
  leftmargin = 6.5em,
  itemindent = 0pt,
}

% \DeclareAcroListStyle { mystyle }{ list }{ list = acronyms }
\acsetup { list/template = description, list/name = Nomenclature }

%% ============================================================================



%% ============================== Code packages ===============================

\usepackage { minted        }
\usepackage { algpseudocode }

%% ------------------------------ Code commands -------------------------------

\renewcommand \listoflistingscaption { List of source codes }

\usemintedstyle       { friendly }
\setminted [ python ] {
  tabsize  = 4,
	fontsize =\footnotesize,
	frame    = lines,
	framesep = 0.5em,
	obeytabs,
	linenos
}

%% ============================================================================



%% =========================== Referencing packages ===========================

\RequirePackage [ hyphens              ] { url      }  % breaks urls at hyphens
\RequirePackage [ hidelinks            ] { hyperref }
\RequirePackage [ noabbrev, capitalise ] { cleveref }

\usepackage{csquotes}
\usepackage[english]{babel}
\usepackage[
    backend=biber,
    natbib,
    style=apa,
    citestyle=apa
]{biblatex}
\DeclareLanguageMapping{english}{english-apa}
\setcounter{biburlucpenalty}{10000}

%% --------------------------- Referencing commands ---------------------------

\providecommand \phantomsection \relax

%% ============================================================================